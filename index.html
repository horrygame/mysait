<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEM_BREACH.exe</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
            user-select: none;
        }
        
        body {
            background-color: #000;
            color: #0f0;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            position: fixed;
        }
        
        #matrix {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.3;
            pointer-events: none;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1;
            text-align: center;
        }
        
        h1 {
            color: #0f0;
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #0f0;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        h2 {
            color: #0f0;
            font-size: 2em;
            margin: 20px 0;
        }
        
        h3 {
            color: #0ff;
            font-size: 1.5em;
            margin: 10px 0;
        }
        
        .warning {
            color: #f00;
            font-size: 1.2em;
            animation: blink 1s infinite;
            font-weight: bold;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .btn {
            background-color: #002200;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 15px 30px;
            font-size: 1.2em;
            margin: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 5px;
        }
        
        .btn:hover {
            background-color: #0f0;
            color: #000;
            box-shadow: 0 0 15px #0f0;
        }
        
        .btn-red {
            background-color: #220000;
            border-color: #f00;
            color: #f00;
        }
        
        .btn-red:hover {
            background-color: #f00;
            color: #fff;
            box-shadow: 0 0 15px #f00;
        }
        
        .question-container {
            max-width: 900px;
            width: 100%;
            background-color: rgba(0, 30, 0, 0.8);
            border: 2px solid #0f0;
            border-radius: 10px;
            padding: 20px;
            margin: 20px;
            text-align: left;
        }
        
        .question-text {
            color: #fff;
            font-size: 1.3em;
            margin-bottom: 30px;
            line-height: 1.5;
        }
        
        .options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .option {
            background-color: #001100;
            border: 1px solid #0a0;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 5px;
        }
        
        .option:hover {
            background-color: #003300;
            border-color: #0f0;
        }
        
        .option.selected {
            background-color: #0a0;
            color: #000;
            font-weight: bold;
        }
        
        .question-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .question-list {
            position: fixed;
            left: 20px;
            top: 100px;
            background-color: rgba(0, 20, 0, 0.9);
            border: 1px solid #0a0;
            padding: 15px;
            border-radius: 5px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .question-item {
            padding: 5px 10px;
            margin: 3px 0;
            cursor: pointer;
            border-radius: 3px;
        }
        
        .question-item.current {
            background-color: #0a0;
            color: #000;
            font-weight: bold;
        }
        
        .question-item.answered {
            color: #0f0;
        }
        
        .question-item.password {
            color: #0ff;
        }
        
        .password-input {
            background-color: #001100;
            color: #0f0;
            border: 2px solid #0a0;
            padding: 15px;
            font-size: 1.5em;
            width: 100%;
            text-align: center;
            letter-spacing: 5px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-width: 300px;
            margin: 20px auto;
        }
        
        .keypad-btn {
            background-color: #002200;
            color: #0f0;
            border: 1px solid #0a0;
            padding: 20px;
            font-size: 1.5em;
            cursor: pointer;
            border-radius: 5px;
        }
        
        .keypad-btn:hover {
            background-color: #004400;
        }
        
        .lockdown-screen {
            background-color: #f00;
            animation: redPulse 0.5s infinite;
        }
        
        @keyframes redPulse {
            0%, 100% { background-color: #f00; }
            50% { background-color: #800; }
        }
        
        .lockdown-text {
            color: #fff;
            font-size: 3em;
            text-shadow: 0 0 10px #fff;
            margin-bottom: 30px;
        }
        
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: rgba(0, 20, 0, 0.9);
            padding: 10px;
            text-align: center;
            border-top: 2px solid #0a0;
            z-index: 100;
        }
        
        .progress {
            color: #0ff;
            font-weight: bold;
        }
        
        .lockdown-warning {
            position: fixed;
            top: 10px;
            left: 10px;
            color: #f00;
            font-weight: bold;
            animation: blink 0.5s infinite;
        }
        
        .char {
            position: absolute;
            color: #0f0;
            font-size: 20px;
            font-weight: bold;
        }
        
        .congrats-text {
            color: #0f0;
            font-size: 2.5em;
            margin: 20px 0;
            text-shadow: 0 0 10px #0f0;
            animation: colorChange 3s infinite;
        }
        
        @keyframes colorChange {
            0% { color: #0f0; }
            33% { color: #0ff; }
            66% { color: #f0f; }
            100% { color: #0f0; }
        }
        
        #blocker {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 0, 0, 0.9);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        #closeAttempts {
            font-size: 4em;
            color: white;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        #attemptText {
            color: white;
            font-size: 2em;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="matrix"></div>
    
    <div id="blocker">
        <div id="closeAttempts">0</div>
        <div id="attemptText">ПОПЫТКА НЕСАНКЦИОНИРОВАННОГО ВЫХОДА<br>СИСТЕМА ЗАБЛОКИРОВАНА</div>
    </div>
    
    <div id="welcomeScreen" class="screen">
        <h1>СИСТЕМА БЕЗОПАСНОСТИ</h1>
        <h2>ДОСТУП К ЦЕНТРАЛЬНОМУ СЕРВЕРУ</h2>
        
        <button class="btn" onclick="startGame()">АКТИВИРОВАТЬ СИСТЕМУ</button>
        
        <div style="margin-top: 50px;">
            <h3>Для получения доступа пройдите тест безопасности</h3>
            <p>17 вопросов | 4 темы | Полная блокировка системы</p>
            <p class="warning">ВНИМАНИЕ: ПОПЫТКИ ВЫХОДА БУДУТ ЗАБЛОКИРОВАНЫ</p>
        </div>
    </div>
    
    <div id="questionScreen" class="screen" style="display: none;">
        <h2>ТЕСТ БЕЗОПАСНОСТИ</h2>
        <h3 id="questionNumber">Вопрос 1 из 17</h3>
        <div id="questionType" style="color: #ff0;">Тема: Загрузка...</div>
        
        <div class="question-container">
            <div id="questionText" class="question-text">
                Загрузка вопроса...
            </div>
            
            <div id="options" class="options">
                <!-- Варианты ответов будут здесь -->
            </div>
            
            <div class="question-nav">
                <button class="btn" onclick="prevQuestion()" id="prevBtn">← НАЗАД</button>
                <button class="btn" onclick="nextQuestion()" id="nextBtn">ДАЛЕЕ →</button>
            </div>
        </div>
        
        <div class="question-list" id="questionList">
            <div style="color: #0f0; margin-bottom: 10px; font-weight: bold;">ВОПРОСЫ:</div>
        </div>
    </div>
    
    <div id="passwordScreen" class="screen" style="display: none;">
        <h2>ФИНАЛЬНЫЙ ШАГ</h2>
        <h3 style="color: #f00;">ПРИШЛО ВРЕМЯ УЙТИ ОТСЮДА</h3>
        <div style="color: #0f0; font-size: 1.2em; max-width: 800px; margin: 20px auto;">
            Введи пароль - это правильные ответы на все предыдущие вопросы по порядку
        </div>
        
        <div class="password-input" id="passwordDisplay">_______________</div>
        
        <div style="color: #ff0; margin-bottom: 20px;">
            Введите 17-значный пароль (номера правильных ответов на вопросы 1-17)
        </div>
        
        <div class="keypad" id="keypad">
            <!-- Клавиатура будет создана JavaScript -->
        </div>
        
        <div style="margin-top: 30px;">
            <button class="btn" onclick="checkPassword()">ПРОВЕРИТЬ ПАРОЛЬ</button>
            <button class="btn btn-blue" onclick="backToQuestions()">← К ВОПРОСАМ</button>
        </div>
    </div>
    
    <div id="lockdownScreen" class="screen lockdown-screen" style="display: none;">
        <div class="lockdown-text">!</div>
        <div class="lockdown-text">ПОПЫТКА НЕСАНКЦИОНИРОВАННОГО ВЫХОДА</div>
        <div class="lockdown-text">СИСТЕМА ЗАБЛОКИРОВАНА</div>
        
        <div style="background-color: #000; padding: 20px; border-radius: 10px; margin: 30px; max-width: 400px;">
            <div class="password-input" id="lockdownDisplay">________</div>
            <div style="color: #fff; margin: 10px 0;" id="lockdownMessage">
                Введите пароль для разблокировки
            </div>
            
            <div class="keypad" id="lockdownKeypad">
                <!-- Клавиатура блокировки будет создана JavaScript -->
            </div>
            
            <div style="margin-top: 20px;">
                <button class="btn btn-red" onclick="checkLockdownPassword()">ВВОД</button>
            </div>
        </div>
        
        <div class="lockdown-warning" id="lockdownWarning">
            РЕЖИМ БЛОКИРОВКИ АКТИВИРОВАН
        </div>
    </div>
    
    <div id="congratsScreen" class="screen" style="display: none;">
        <div class="congrats-text">ДОСТУП РАЗРЕШЕН</div>
        <div class="congrats-text">СИСТЕМНЫЙ ВЗЛОМ УСПЕШЕН</div>
        <div class="congrats-text">ПАРОЛЬ ПОДТВЕРЖДЕН</div>
        <div class="congrats-text">ВЫ ПОЛУЧАЕТЕ 5 ЗА УРОК</div>
        <div class="congrats-text">ОЦЕНКА: 5/5</div>
        
        <button class="btn btn-red" onclick="exitGame()" style="margin-top: 50px;">ВЫЙТИ ИЗ СИСТЕМЫ</button>
    </div>
    
    <div class="status-bar" id="statusBar" style="display: none;">
        <div class="progress" id="progressText">Ответов: 0/17</div>
        <div style="color: #f00;">СИСТЕМА ЗАБЛОКИРОВАНА • ИСПОЛЬЗУЙТЕ МЫШЬ</div>
    </div>

    <script>
        // === БЕЗОПАСНОЕ ХРАНЕНИЕ ПАРОЛЯ ===
        let currentGame = null;
        let userAnswers = Array(17).fill(-1);
        
        function generateGame() {
            const seed = Date.now() + Math.random();
            const rng = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
            const shuffle = (arr) => [...arr].sort(() => Math.random() - 0.5);
            
            const questions = [];
            const correctAnswers = [];
            
            // 1. Системы счисления (6 вопросов)
            // Вопрос 1: Двоичное в десятичное
            {
                const num = rng(32, 63);
                const correct = parseInt(num.toString(2), 2);
                const options = [correct-2, correct-1, correct+1, correct+2];
                const correctIndex = rng(0, 3);
                options[correctIndex] = correct;
                questions.push({
                    text: `Переведите двоичное число ${num.toString(2)} в десятичную систему.`,
                    options: shuffle(options.map(o => o.toString())),
                    type: "Системы счисления"
                });
                correctAnswers.push(correctIndex);
            }
            
            // Вопрос 2: Система счисления равенства
            {
                const base = rng(5, 8);
                const a = rng(5, 12);
                const b = rng(5, 12);
                const sum = a + b;
                const sumStr = sum.toString(base);
                const bases = ["двоичной", "восьмеричной", "шестнадцатеричной", `${base}-ичной`];
                questions.push({
                    text: `В какой системе счисления выполняется равенство ${a} + ${b} = ${sumStr}?`,
                    options: shuffle([...bases]),
                    type: "Системы счисления"
                });
                correctAnswers.push(bases.indexOf(`${base}-ичной`));
            }
            
            // Вопрос 3: Единицы в двоичной записи
            {
                const num = rng(60, 100);
                const ones = num.toString(2).split('1').length - 1;
                const options = [ones-2, ones-1, ones+1, ones+2].filter(o => o > 0);
                while(options.length < 4) options.push(rng(1, 8));
                const correctIndex = rng(0, 3);
                options[correctIndex] = ones;
                questions.push({
                    text: `Сколько единиц в двоичной записи числа ${num}?`,
                    options: shuffle(options.map(o => o.toString())),
                    type: "Системы счисления"
                });
                correctAnswers.push(options.indexOf(ones));
            }
            
            // Вопрос 4: Сумма двоичных чисел
            {
                const a = rng(5, 10);
                const b = rng(5, 10);
                const sum = a + b;
                const correct = sum.toString(2);
                const wrong1 = (sum-1).toString(2);
                const wrong2 = (sum+1).toString(2);
                const wrong3 = (a+b+2).toString(2);
                const options = [wrong1, wrong2, wrong3, correct];
                const correctIndex = rng(0, 3);
                [options[correctIndex], options[3]] = [options[3], options[correctIndex]];
                questions.push({
                    text: `Чему равна сумма чисел ${a.toString(2)}₂ и ${b.toString(2)}₂ в двоичной системе?`,
                    options: shuffle(options),
                    type: "Системы счисления"
                });
                correctAnswers.push(options.indexOf(correct));
            }
            
            // Вопрос 5: Десятичное в восьмеричное
            {
                const num = rng(50, 150);
                const correct = num.toString(8);
                const options = [
                    (num-2).toString(8),
                    (num-1).toString(8),
                    (num+1).toString(8),
                    (num+2).toString(8)
                ];
                const correctIndex = rng(0, 3);
                options[correctIndex] = correct;
                questions.push({
                    text: `Переведите десятичное число ${num} в восьмеричную систему.`,
                    options: shuffle(options),
                    type: "Системы счисления"
                });
                correctAnswers.push(correctIndex);
            }
            
            // Вопрос 6: Шестнадцатеричное в десятичное
            {
                const hex = rng(160, 250).toString(16).toUpperCase();
                const correct = parseInt(hex, 16);
                const options = [correct-3, correct-1, correct+1, correct+3];
                const correctIndex = rng(0, 3);
                options[correctIndex] = correct;
                questions.push({
                    text: `Переведите шестнадцатеричное число ${hex} в десятичную систему.`,
                    options: shuffle(options.map(o => o.toString())),
                    type: "Системы счисления"
                });
                correctAnswers.push(correctIndex);
            }
            
            // 2. Круги Эйлера (6 вопросов)
            for(let i = 0; i < 6; i++) {
                const total = rng(30, 50);
                const setA = rng(15, total-10);
                const setB = rng(10, total-15);
                const both = rng(5, Math.min(setA, setB));
                const correct = total - setA - setB + both;
                
                let formula = "";
                let wrong = [];
                
                switch(i % 6) {
                    case 0:
                        formula = `${total} человек. ${setA} занимаются спортом, ${setB} - музыкой, ${both} - и тем и другим. Сколько человек ничем не занимаются?`;
                        wrong = [total-setA-setB, setA+setB, total-both, setA+setB-2*both];
                        break;
                    case 1:
                        formula = `Из ${total} туристов ${setA} знают английский, ${setB} - французский, ${both} - оба языка. Сколько туристов не знают ни одного языка?`;
                        wrong = [setA+setB-both, total-both, setA+setB-2*both, total-setA-setB];
                        break;
                    case 2:
                        formula = `В группе ${total} студентов. ${setA} сдают математику, ${setB} - физику, ${both} - оба экзамена. Сколько студентов не сдают эти экзамены?`;
                        wrong = [setA+setB-both, total-both, setA+setB-2*both, Math.abs(total-setA-setB)];
                        break;
                    case 3:
                        formula = `На предприятии ${total} работников. ${setA} умеют работать на станке А, ${setB} - на станке Б, ${both} - на обоих. Сколько не умеют работать ни на одном станке?`;
                        wrong = [setA+setB-both, total-both, setA+setB-2*both, Math.abs(setA-setB)];
                        break;
                    case 4:
                        formula = `В классе ${total} учеников. Все посещают хотя бы один кружок: ${setA} - математический, ${setB} - биологический, ${both} - оба. Сколько посещают только один кружок?`;
                        const correctSingle = setA + setB - 2*both;
                        wrong = [total-both, setA+setB-both, total-both*2, Math.abs(setA-setB)];
                        const optionsSingle = [...wrong];
                        const correctIndexSingle = rng(0, 3);
                        optionsSingle[correctIndexSingle] = correctSingle;
                        questions.push({
                            text: formula,
                            options: shuffle(optionsSingle.map(o => o.toString())),
                            type: "Круги Эйлера"
                        });
                        correctAnswers.push(correctIndexSingle);
                        continue;
                    case 5:
                        formula = `В школе ${total} учеников. ${setA} любят математику, ${setB} - физику, ${both} - обе науки. Сколько учеников не любят ни математику, ни физику?`;
                        wrong = [setA+setB-both, total-both, setA+setB-2*both, Math.abs(setA-setB)];
                        break;
                }
                
                const options = [...wrong];
                const correctIndex = rng(0, 3);
                options[correctIndex] = correct;
                questions.push({
                    text: formula,
                    options: shuffle(options.map(o => o.toString())),
                    type: "Круги Эйлера"
                });
                correctAnswers.push(correctIndex);
            }
            
            // 3. Таблицы истинности (5 вопросов)
            const logicQuestions = [
                { a: 3, b: 7, op: "И", answer: 5 },
                { a: 5, op: "ИЛИ", answer: 5 },
                { a: 4, b: 2, op: "НЕ", answer: 4 },
                { a: 3, b: 5, c: 2, d: 6, answer: 4 },
                { a: 2, b: 6, exclude: 4, answer: 3 }
            ];
            
            logicQuestions.forEach((q, idx) => {
                let text = "";
                let options = [];
                
                if(idx === 0) {
                    text = `Для какого значения X истинно высказывание: (X > ${q.a}) И (X < ${q.b})?`;
                    options = [q.answer-2, q.answer-1, q.answer+1, q.answer+2];
                } else if(idx === 1) {
                    text = `Для какого значения X ложно высказывание: (X > ${q.a}) ИЛИ (X < ${q.a})?`;
                    options = [q.a-2, q.a, q.a+1, q.a+2];
                } else if(idx === 2) {
                    text = `Для какого значения X истинно высказывание: НЕ(X < ${q.a}) И (X > ${q.b})?`;
                    options = [q.a-2, q.b, q.a, q.a+1];
                } else if(idx === 3) {
                    text = `Для какого значения X ложно высказывание: (X ≠ ${q.a}) И (X ≠ ${q.b}) И (X > ${q.c}) И (X < ${q.d})?`;
                    options = [q.answer-2, q.answer+1, q.answer+2, q.answer];
                } else {
                    text = `Для какого значения X истинно высказывание: (X > ${q.a}) И (X < ${q.b}) И (X ≠ ${q.exclude})?`;
                    options = [q.answer-1, q.answer+1, q.answer+2, 
                        [q.answer-1, q.answer, q.answer+1, q.answer+2].find(x => x > q.a && x < q.b && x !== q.exclude && !options.includes(x))];
                }
                
                const correctIndex = rng(0, 3);
                options[correctIndex] = q.answer;
                questions.push({
                    text,
                    options: shuffle(options.map(o => o.toString())),
                    type: "Таблицы истинности"
                });
                correctAnswers.push(correctIndex);
            });
            
            // 4. История России (последний вопрос)
            const historyEvents = [
                { event: "Крещение Руси", year: 988 },
                { event: "Ледовое побоище", year: 1242 },
                { event: "Куликовская битва", year: 1380 },
                { event: "Освобождение от монголо-татарского ига", year: 1480 },
                { event: "Восстание декабристов", year: 1825 },
                { event: "Отмена крепостного права", year: 1861 },
                { event: "Октябрьская революция", year: 1917 },
                { event: "Полёт Гагарина в космос", year: 1961 },
                { event: "Распад СССР", year: 1991 }
            ];
            
            const event = historyEvents[rng(0, historyEvents.length-1)];
            const options = [event.year-10, event.year-1, event.year+1, event.year+10];
            const correctIndex = rng(0, 3);
            options[correctIndex] = event.year;
            
            questions.push({
                text: `В каком году произошло ${event.event}?`,
                options: shuffle(options.map(o => o.toString())),
                type: "История России"
            });
            correctAnswers.push(correctIndex);
            
            // Генерируем пароль
            const password = correctAnswers.map(a => a + 1).join('');
            const unlockCode = Array.from({length: 8}, () => rng(0, 9)).join('');
            
            return {
                questions,
                correctAnswers,
                password,
                unlockCode,
                seed
            };
        }
        
        // === ОСНОВНАЯ ИГРА ===
        let gameState = "welcome";
        let currentQuestionIndex = 0;
        let userPassword = "";
        let lockdownPassword = "";
        let lockdownAttempts = 0;
        let closeAttempts = 0;
        let isLocked = true;
        let correctPassword = "";
        let unlockPassword = "";
        
        function startGame() {
            currentGame = generateGame();
            correctPassword = currentGame.password;
            unlockPassword = currentGame.unlockCode;
            
            console.log("=== ИНФОРМАЦИЯ ДЛЯ ПРОВЕРКИ ===");
            console.log("Пароль для прохождения:", correctPassword);
            console.log("Пароль разблокировки:", unlockPassword);
            console.log("==============================");
            
            gameState = "questions";
            currentQuestionIndex = 0;
            userAnswers = Array(17).fill(-1);
            showScreen('questionScreen');
            document.getElementById('statusBar').style.display = 'block';
            updateQuestion();
            updateQuestionList();
            updateProgress();
        }
        
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.style.display = 'none';
            });
            document.getElementById(screenId).style.display = 'flex';
            
            if(screenId === 'questionScreen' || screenId === 'passwordScreen') {
                document.getElementById('statusBar').style.display = 'block';
            } else {
                document.getElementById('statusBar').style.display = 'none';
            }
        }
        
        function updateQuestion() {
            if(!currentGame || currentQuestionIndex >= 17) return;
            
            const q = currentGame.questions[currentQuestionIndex];
            document.getElementById('questionNumber').textContent = `Вопрос ${currentQuestionIndex + 1} из 17`;
            document.getElementById('questionType').textContent = `Тема: ${q.type}`;
            document.getElementById('questionText').textContent = q.text;
            
            document.getElementById('prevBtn').style.visibility = currentQuestionIndex > 0 ? 'visible' : 'hidden';
            document.getElementById('nextBtn').textContent = currentQuestionIndex < 16 ? 'ДАЛЕЕ →' : 'К ПАРОЛЮ →';
            
            const optionsDiv = document.getElementById('options');
            optionsDiv.innerHTML = '';
            
            q.options.forEach((option, index) => {
                const div = document.createElement('div');
                div.className = `option ${userAnswers[currentQuestionIndex] === index ? 'selected' : ''}`;
                div.textContent = `${index + 1}. ${option}`;
                div.onclick = () => selectOption(index);
                optionsDiv.appendChild(div);
            });
        }
        
        function selectOption(index) {
            userAnswers[currentQuestionIndex] = index;
            updateQuestion();
            updateQuestionList();
            updateProgress();
        }
        
        function prevQuestion() {
            if(currentQuestionIndex > 0) {
                currentQuestionIndex--;
                updateQuestion();
                updateQuestionList();
            }
        }
        
        function nextQuestion() {
            if(currentQuestionIndex < 16) {
                currentQuestionIndex++;
                updateQuestion();
                updateQuestionList();
            } else if(currentQuestionIndex === 16) {
                showPasswordScreen();
            }
        }
        
        function updateQuestionList() {
            const listDiv = document.getElementById('questionList');
            listDiv.innerHTML = '<div style="color: #0f0; margin-bottom: 10px; font-weight: bold;">ВОПРОСЫ:</div>';
            
            for(let i = 0; i < 17; i++) {
                const div = document.createElement('div');
                div.className = 'question-item';
                
                if(i === currentQuestionIndex) div.classList.add('current');
                if(userAnswers[i] !== -1) div.classList.add('answered');
                
                if(i < 16) {
                    div.textContent = `${i + 1}. ${currentGame.questions[i].type.substring(0, 8)}` + 
                                    (userAnswers[i] !== -1 ? ` [${userAnswers[i] + 1}]` : '');
                } else {
                    div.classList.add('password');
                    div.textContent = '17. ПАРОЛЬ';
                }
                
                div.onclick = () => {
                    if(i < 16) {
                        currentQuestionIndex = i;
                        updateQuestion();
                        updateQuestionList();
                    } else {
                        showPasswordScreen();
                    }
                };
                
                listDiv.appendChild(div);
            }
        }
        
        function updateProgress() {
            const answered = userAnswers.filter(a => a !== -1).length;
            document.getElementById('progressText').textContent = `Ответов: ${answered}/17`;
        }
        
        // === ПАРОЛЬ ===
        function showPasswordScreen() {
            gameState = "password";
            currentQuestionIndex = 16;
            showScreen('passwordScreen');
            userPassword = "";
            updatePasswordDisplay();
            createKeypad();
        }
        
        function updatePasswordDisplay() {
            let display = userPassword;
            while(display.length < 17) display += '_';
            
            let formatted = '';
            for(let i = 0; i < display.length; i++) {
                formatted += display[i];
                if((i + 1) % 5 === 0 && i < 16) formatted += ' ';
            }
            
            document.getElementById('passwordDisplay').textContent = formatted;
        }
        
        function createKeypad() {
            const keypad = document.getElementById('keypad');
            keypad.innerHTML = '';
            
            for(let i = 1; i <= 9; i++) {
                const btn = document.createElement('button');
                btn.className = 'keypad-btn';
                btn.textContent = i;
                btn.onclick = () => addToPassword(i.toString());
                keypad.appendChild(btn);
            }
            
            const zeroBtn = document.createElement('button');
            zeroBtn.className = 'keypad-btn';
            zeroBtn.textContent = '0';
            zeroBtn.onclick = () => addToPassword('0');
            keypad.appendChild(zeroBtn);
            
            const delBtn = document.createElement('button');
            delBtn.className = 'keypad-btn btn-red';
            delBtn.textContent = '⌫';
            delBtn.onclick = () => {
                userPassword = userPassword.slice(0, -1);
                updatePasswordDisplay();
            };
            keypad.appendChild(delBtn);
        }
        
        function addToPassword(digit) {
            if(userPassword.length < 17) {
                userPassword += digit;
                updatePasswordDisplay();
            }
        }
        
        function checkPassword() {
            if(userPassword.length !== 17) {
                alert('Пароль должен содержать ровно 17 цифр!');
                return;
            }
            
            if(userPassword === correctPassword) {
                gameState = "congrats";
                showScreen('congratsScreen');
                isLocked = false;
            } else {
                alert('НЕВЕРНЫЙ ПАРОЛЬ!\nДоступ запрещён.\nПароль сброшен.');
                userPassword = '';
                updatePasswordDisplay();
            }
        }
        
        function backToQuestions() {
            gameState = "questions";
            currentQuestionIndex = 15;
            showScreen('questionScreen');
            updateQuestion();
            updateQuestionList();
        }
        
        // === БЛОКИРОВКА ===
        window.addEventListener('beforeunload', function(e) {
            if(gameState !== "congrats" && isLocked) {
                e.preventDefault();
                e.returnValue = '';
                triggerCloseAttempt();
                return '';
            }
        });
        
        function triggerCloseAttempt() {
            closeAttempts++;
            document.getElementById('closeAttempts').textContent = closeAttempts;
            document.getElementById('blocker').style.display = 'flex';
            
            setTimeout(() => {
                document.getElementById('blocker').style.display = 'none';
            }, 3000);
            
            if(closeAttempts >= 3) {
                triggerLockdown();
            }
        }
        
        function triggerLockdown() {
            gameState = "lockdown";
            showScreen('lockdownScreen');
            document.getElementById('statusBar').style.display = 'none';
            isLocked = true;
            lockdownPassword = "";
            updateLockdownDisplay();
            setupLockdownKeypad();
        }
        
        function setupLockdownKeypad() {
            const keypad = document.getElementById('lockdownKeypad');
            keypad.innerHTML = '';
            
            for(let i = 1; i <= 9; i++) {
                const btn = document.createElement('button');
                btn.className = 'keypad-btn';
                btn.style.backgroundColor = '#000';
                btn.style.color = '#fff';
                btn.style.borderColor = '#fff';
                btn.textContent = i;
                btn.onclick = () => addToLockdownPassword(i.toString());
                keypad.appendChild(btn);
            }
            
            const zeroBtn = document.createElement('button');
            zeroBtn.className = 'keypad-btn';
            zeroBtn.style.backgroundColor = '#000';
            zeroBtn.style.color = '#fff';
            zeroBtn.style.borderColor = '#fff';
            zeroBtn.textContent = '0';
            zeroBtn.onclick = () => addToLockdownPassword('0');
            keypad.appendChild(zeroBtn);
            
            const delBtn = document.createElement('button');
            delBtn.className = 'keypad-btn';
            delBtn.style.backgroundColor = '#000';
            delBtn.style.color = '#fff';
            delBtn.style.borderColor = '#fff';
            delBtn.textContent = '⌫';
            delBtn.onclick = () => {
                lockdownPassword = lockdownPassword.slice(0, -1);
                updateLockdownDisplay();
            };
            keypad.appendChild(delBtn);
        }
        
        function addToLockdownPassword(digit) {
            if(lockdownPassword.length < 8) {
                lockdownPassword += digit;
                updateLockdownDisplay();
            }
        }
        
        function updateLockdownDisplay() {
            let display = '';
            for(let i = 0; i < 8; i++) {
                display += i < lockdownPassword.length ? '*' : '_';
            }
            document.getElementById('lockdownDisplay').textContent = display;
            
            if(lockdownAttempts > 0) {
                document.getElementById('lockdownMessage').innerHTML = 
                    `Неверный пароль. Попыток: ${lockdownAttempts}/3`;
            }
        }
        
        function checkLockdownPassword() {
            if(lockdownPassword === unlockPassword) {
                lockdownPassword = "";
                lockdownAttempts = 0;
                isLocked = false;
                
                if(gameState === "lockdown") {
                    gameState = "questions";
                    showScreen('questionScreen');
                    document.getElementById('statusBar').style.display = 'block';
                    updateQuestion();
                    updateQuestionList();
                }
            } else {
                lockdownAttempts++;
                lockdownPassword = "";
                updateLockdownDisplay();
                
                if(lockdownAttempts >= 3) {
                    document.getElementById('lockdownMessage').innerHTML = 
                        'СИСТЕМА ОКОНЧАТЕЛЬНО ЗАБЛОКИРОВАНА<br>Перезагрузите страницу';
                    document.getElementById('lockdownKeypad').innerHTML = '';
                    document.querySelector('#lockdownScreen button').style.display = 'none';
                }
            }
        }
        
        function exitGame() {
            if(gameState === "congrats") {
                alert('SYSTEM_BREACH завершён. Окно закроется через 3 секунды...');
                document.body.style.opacity = '0';
                document.body.style.transition = 'opacity 3s';
                
                setTimeout(() => {
                    window.close();
                }, 3000);
            }
        }
        
        // === ИНИЦИАЛИЗАЦИЯ ===
        window.onload = function() {
            // Матричный эффект
            const matrixDiv = document.getElementById('matrix');
            const chars = "01█▓▒░╬╣║╗╝╚╔╩╦╠═╬╧╨╤╥╙╘╒╓╫╪┘┌┐└┴┬├┼╞╟╚╔╩╦╠═╬░▒▓█";
            const matrixElements = [];
            
            for(let i = 0; i < 50; i++) {
                const char = document.createElement('div');
                char.className = 'char';
                char.textContent = chars[Math.floor(Math.random() * chars.length)];
                char.style.left = Math.random() * 100 + 'vw';
                char.style.top = Math.random() * 100 + 'vh';
                char.style.opacity = Math.random() * 0.5 + 0.3;
                matrixDiv.appendChild(char);
                matrixElements.push({
                    element: char,
                    speed: Math.random() * 2 + 1
                });
            }
            
            setInterval(() => {
                matrixElements.forEach(item => {
                    let top = parseFloat(item.element.style.top);
                    top += item.speed;
                    if(top > 100) {
                        top = -10;
                        item.element.style.left = Math.random() * 100 + 'vw';
                        item.element.textContent = chars[Math.floor(Math.random() * chars.length)];
                    }
                    item.element.style.top = top + 'vh';
                });
            }, 50);
            
            // Блокировка клавиш
            document.addEventListener('keydown', function(e) {
                if(e.key === 'F4' && e.altKey || e.key === 'Escape' || e.key === 'Meta' || 
                   (e.altKey && e.key === 'Tab') || (e.ctrlKey && e.key === 'w')) {
                    e.preventDefault();
                    triggerCloseAttempt();
                }
            });
            
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                triggerLockdown();
            });
            
            console.log("=== SYSTEM_BREACH.exe ===");
            console.log("Игра загружена. Нажмите 'АКТИВИРОВАТЬ СИСТЕМУ' для начала.");
            console.log("Пароль будет показан в консоли после запуска.");
            console.log("========================");
        };
    </script>
</body>
</html>
